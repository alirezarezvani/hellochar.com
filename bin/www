#!/usr/bin/env node

const { exec } = require('child_process');

var app = require('../app');
app.set('port', process.env.PORT || 3000);

const isKiosk = process.argv.indexOf('--kiosk') !== -1;

var server = app.listen(app.get('port'), function() {
  console.log('Express server listening on port ' + server.address().port);
  if (isKiosk) {
    console.log("Starting chrome in kiosk mode");
    exec("startChromeKiosk", (err, stdout, stderr) => {
      console.log(stdout);
      if (err != null) {
        console.error(err);
        console.error(stderr);
      }
    });
  }

});

var io = require('socket.io')(server);

var openPoseRunner = require('../openpose_runner');
openPoseRunner.start((json) => {
  io.sockets.emit('update', json);
});
